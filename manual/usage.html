<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Usage</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual" data-toc-name="tutorial">
    <h1 class="manual-toc-title"><a href="manual/tutorial.html" data-ice="title">Tutorial</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/tutorial.html#express-response-times-example" data-ice="link">Express Response Times Example</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="usage">
    <h1 class="manual-toc-title"><a href="manual/usage.html" data-ice="title">Usage</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/usage.html#a-moment-for-times" data-ice="link">A Moment for Times</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/usage.html#browser-setup" data-ice="link">Browser Setup</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/usage.html#testing" data-ice="link">Testing</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/usage.html#contributing" data-ice="link">Contributing</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#how-to-prepare" data-ice="link">How to prepare</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#make-changes" data-ice="link">Make Changes</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#submit-changes" data-ice="link">Submit Changes</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#additional-resources" data-ice="link">Additional Resources</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="reference">
    <h1 class="manual-toc-title"><a href="identifiers.html" data-ice="title">Reference</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#class" data-ice="link">Class</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#interface" data-ice="link">Interface</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#function" data-ice="link">Function</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#variable" data-ice="link">Variable</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#typedef" data-ice="link">Typedef</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="changelog">
    <h1 class="manual-toc-title"><a href="manual/changelog.html" data-ice="title">Changelog</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#node-influx-changelog" data-ice="link">node-influx Changelog</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-11-12-5-0-1" data-ice="link">2016-11-12, 5.0.1</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-10-27-5-0-0" data-ice="link">2016-10-27, 5.0.0</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-10-24-5-0-0-alpha-4" data-ice="link">2016-10-24, 5.0.0-alpha.4</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-10-22-5-0-0-alpha-3" data-ice="link">2016-10-22, 5.0.0-alpha.3</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-10-21-5-0-0-alpha-2" data-ice="link">2016-10-21, 5.0.0-alpha.2</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-10-15-5-0-0-alpha-1" data-ice="link">2016-10-15, 5.0.0-alpha.1</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-10-06-version-4-2-3" data-ice="link">2016-10-06, Version 4.2.3</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-09-15-version-4-2-2" data-ice="link">2016-09-15, Version 4.2.2</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/changelog.html#2016-05-05-version-4-2-0" data-ice="link">2016-05-05, Version 4.2.0</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-breadcrumb-list">
    <a href="./manual/./index.html">Manual</a>
    <span>&#xBB;</span>
    <span data-ice="title">Usage</span>
  </div>
  <div data-ice="content"><h1 id="a-moment-for-times">A Moment for Times</h1>
<p>InfluxDB is a time series database, so it would make sense that the concept of time is moderately important when dealing with it.</p>
<p>By default, Influx will store all dates you give to it as a nanosecond-precision timestamp, whereas in JavaScript, most of the time we&apos;re dealing with millisecond precision timestamps, which we get from <code>Date.now()</code> or <code>myDate.getTime()</code>. This presents a bit of a problem for us JavaScripters, since nanosecond-precision timestamps are stored as 64-bit unsigned integers that JavaScript simply cannot represent accurately.</p>
<pre><code><code class="source-code prettyprint">&#x279C;  node-influx git:(master) node
&gt; 1475985480231035677
1475985480231035600</code>
</code></pre><p>This module tries to make dates as easy as possible for you to deal with, and out of the box everything should &quot;just work&quot;.</p>
<p>There are three places that dates can get passed around:</p>
<ul>
<li>Dates coming from Influx queries, like <code>select * from my_series</code></li>
<li>Dates being interpolated <em>into</em> Influx queries</li>
<li>Dates being used when writing points on the line protocol, via <code>.writePoints()</code> or <code>.writeMeasurement()</code></li>
</ul>
<p>To deal with this, we introduce a new type called <strong>NanoDate</strong>. These dates behave just like the normal <code>Date</code> type, but have two additional methods: <code>.getNanoTime()</code> and <code>.getNanoISOString()</code>. They behave just like the normal <code>.getTime()</code> and <code>getISOString</code> methods, but they both return nanosecond-precision strings instead of millisecond-precision numbers and timestamps.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">expect(myNanoDate.getTime()).to.equal(1475985480231)
expect(myNanoDate.getNanoTime()).to.equal(&apos;1475985480231035677&apos;)
expect(myNanoDate.toISOString()).to.equal(&apos;2016-10-09T03:58:00.231Z&apos;)
expect(myNanoDate.toNanoISOString()).to.equal(&apos;2016-10-09T03:58:00.231035677Z&apos;)</code>
</code></pre>
<p><strong>All times returned from Influx queries are parsed to INanoDates</strong>. For example, you can do something like the following:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">influx.query(&apos;select * from perf&apos;).then(results =&gt; {
  results.forEach(row =&gt; console.log(`Used ${row.cpu} at ${row.time.toNanoISOString()}`))
})</code>
</code></pre>
<p>When writing data to Influx, <strong>all write methods accept INanoDates in all situations</strong>. This means if you select data from Influx and want to update a data point, you can pass that time right back into the <code>write</code> method. (Remember, points within series are unique by their time!) If you have a nanosecond timestamp from some external source, you can convert it to a INanoDate using <a href="https://node-influx.github.io/function/index.html#static-function-toNanoDate"><code>toNanoDate</code></a>.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">import { toNanoDate } from &apos;influx&apos;

const myNanoDate = toNanoDate(&apos;1475985480231035600&apos;)
expect(myNanoDate.getTime()).to.equal(1475985480231)
expect(myNanoDate.getNanoTime()).to.equal(&apos;1475985480231035600&apos;)
expect(myNanoDate.toNanoISOString()).to.equal(&apos;2016-10-09T03:58:00.231035600Z&apos;)</code>
</code></pre>
<p>Finally, <strong>if you want to embed a INanoDate into an Influx query, you should should use <code>toNanoISOString</code></strong> to so do:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">influx.query(`select * from perf where time &gt; &quot;${myNanoDate.toNanoISOString()}&quot;`)</code>
</code></pre>
<hr>
<p>Anything unclear? Have some remaining questions or found a bug? Feel free to <a href="https://github.com/node-influx/node-influx/issues/new">open an issue</a>, we respond quickly!</p>
<h1 id="browser-setup">Browser Setup</h1>
<p>For Node.js, <code>influx</code> can be installed and you can use it out of the box!</p>
<pre><code><code class="source-code prettyprint">npm install --save influx@next</code>
</code></pre><p>For browsers, this will also work provided you have a bundler which can polyfill Node modules, such as Browserify, Webpack, Jspm, or Rollup with <a href="https://github.com/rollup/rollup-plugin-node-resolve">rollup-plugin-node-resolve</a>.</p>
<p>However, at the time of writing, request timeouts will not work by default on any of these platforms until they update to the latest Node API changes. If this is an important feature for you, we recommend that you instruct your bundler to use our <a href="https://github.com/node-influx/stream-http">patched version</a> of <code>stream-http</code> as your <code>http</code> polyfill. You can install it via:</p>
<pre><code><code class="source-code prettyprint">npm install --save node-influx/stream-http</code>
</code></pre><p>You can tell Webpack to use this module by adding the following section in your <code>webpack.config.js</code>:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const http = path.resolve(__dirname, &apos;node_modules/stream-http/index.js&apos;)

module.exports = {
  resolve: {
    alias: { http, https: http }
  }

  // the rest of your webpack config
}</code>
</code></pre>
<p>You can tell Browserify to use this module by adding the following into your build config:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const http = require(&apos;stream-http&apos;)

browserify(myFiles, {
  builtins: Object.assign(
    {}, require(&apos;browserify/lib/builtins&apos;),
    { http, https: http }
  )

  // the rest of your browserify config
})</code>
</code></pre>
<h1 id="testing">Testing</h1>
<p><code>influx</code> is tested primarily with a suite of unit tests in additional to functional tests which require an InfluxDB instance to run. The recommended way of running Influx is use their official Docker image:</p>
<pre><code><code class="source-code prettyprint">docker run -d -p 8083:8083 -p 8086:8086 --expose 8090 --expose 8099 influxdb</code>
</code></pre><p>Alternately, you can use a local installation of the package. If you would like to contribute and don&apos;t want to set up a full Influx testing environment, you can run solely unit tests and linting via <code>npm-run-all test:unit test:lint</code>, which do not require anything other than an <code>npm install</code>.</p>
<p>When running tests you can configure where Influx lives by setting an environment variable which is a valid host to pass into the <a href="https://node-influx.github.io/typedef/index.html#static-typedef-IClusterConfig">IClusterConfig</a> object.</p>
<pre><code><code class="source-code prettyprint">&#x279C;  node-influx git:(master) export INFLUX_HOST=&apos;{&quot;host&quot;:&quot;127.0.0.1&quot;,&quot;port&quot;:12345}&apos;
&#x279C;  node-influx git:(master) npm test</code>
</code></pre><p>You can run <code>npm run test:watch</code> to watch files and automatically re-run tests when they change.</p>
<h1 id="contributing">Contributing</h1>
<p>We&apos;d like to encourage you to contribute to the repository. You can do this by making an <a href="https://github.com/node-influx/node-influx/issues">issue ticket</a> or, even better, submitting a patch via a pull request.</p>
<p>We try to make it as easy as possible for you but there are a few things to consider when contributing. The following guidelines for contribution should be followed if you want to submit a pull request:</p>
<h2 id="how-to-prepare">How to prepare</h2>
<ul>
<li>You need a <a href="https://github.com/signup/free">GitHub account</a></li>
<li>Submit an <a href="https://github.com/node-influx/node-influx/issues">issue ticket</a> for your issue if there is not one yet.<ul>
<li>Describe the issue and include steps to reproduce if it&apos;s a bug.</li>
<li>Ensure to mention the earliest version that you know is affected.</li>
</ul>
</li>
<li>If you are able and want to fix this, fork the repository on GitHub</li>
</ul>
<h2 id="make-changes">Make Changes</h2>
<ul>
<li>In your forked repository, create a topic branch for your upcoming patch. (e.g. <code>feature--autoplay</code> or <code>bugfix--ios-crash</code>)<ul>
<li>Usually this is based on the master branch.</li>
<li>Create a branch based on master; <code>git branch
fix/master/my_contribution master</code> then checkout the new branch with <code>git
checkout fix/master/my_contribution</code>.  Please avoid working directly on the <code>master</code> branch.</li>
</ul>
</li>
<li>Make sure you follow the established coding style. You can run <code>npm run test:lint</code> to verify you&apos;re all set.</li>
<li>Make use of the <code>.editorconfig</code>-file if provided with the repository.</li>
<li>Make commits of logical units and describe them properly, documenting anything new that you add.</li>
<li>If possible, submit tests to your patch / new feature so it can be tested easily.</li>
<li>Assure nothing is broken by running all the tests via <code>npm test</code>.</li>
</ul>
<h2 id="submit-changes">Submit Changes</h2>
<ul>
<li>Push your changes to a topic branch in your fork of the repository.</li>
<li>Open a pull request to the this repository and choose the right original branch you want to patch.</li>
<li>If not done in commit messages (which you really should do) please reference and update your issue with the code changes. But <em>please do not close the issue yourself</em>.</li>
<li>We&apos;ll review your changes and respond soon, usually within a day!</li>
</ul>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="http://help.github.com/">General GitHub documentation</a></li>
<li><a href="http://help.github.com/send-pull-requests/">GitHub pull request documentation</a></li>
</ul>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
